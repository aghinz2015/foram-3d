var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},Foram3D;!function(t){var e=function(e){function r(t,r,o){this.center=t,this.origin=t,this.radius=r,this.thickness=o;var a=this.buildGeometry(),i=this.buildMaterial();e.call(this,a,i),this.aperture=this.calculateAperture()}return __extends(r,e),r.prototype.setAncestor=function(t){this.ancestor=t,this.origin=t.aperture,t.child=this},r.prototype.setAperture=function(t){this.aperture=t,this.markAperture()},r.prototype.showThicknessVector=function(){this.thicknessVector||(this.thicknessVector=this.buildThicknessVector(),this.add(this.thicknessVector)),this.thicknessVector.visible=!0},r.prototype.hideThicknessVector=function(){this.thicknessVector&&(this.thicknessVector.visible=!1)},r.prototype.markAperture=function(){this.apertureMarker=this.buildApertureMarker(),this.add(this.apertureMarker)},r.prototype.getSurfaceArea=function(){if(!this.surfaceArea){var e=new t.Calculators.Chamber.SurfaceAreaCalculator(this);this.surfaceArea=e.calculate()}return this.surfaceArea},r.prototype.getMaterialVolume=function(){if(!this.materialVolume){var e=new t.Calculators.Chamber.MaterialVolumeCalculator(this);this.materialVolume=e.calculate()}return this.materialVolume},r.prototype.serialize=function(){return{radius:this.radius,thickness:this.thickness}},r.prototype.applyMaterial=function(t){for(var e in t)this.material[e]=t[e]},r.prototype.setColor=function(t){this.material.color.set(t)},r.prototype.resetColor=function(){this.material.color.set(r.MATERIAL_DEFAULTS.color)},r.prototype.distanceTo=function(t){return this.center.distanceTo(t.center)},r.prototype.intersects=function(t){return this.distanceTo(t)<this.radius+t.radius},r.prototype.getIntersectingChambers=function(){for(var t=[],e=this.ancestor;e;)e.intersects(this)&&t.push(e),e=e.ancestor;return t},r.prototype.buildApertureMarker=function(){var e={color:r.APERTURE_MARKER_COLOR,size:this.radius*r.APERTURE_MARKER_SIZE_FACTOR};return new t.Helpers.Point(this.aperture,e)},r.prototype.buildGeometry=function(){var t=new THREE.SphereGeometry(this.radius,r.WIDTH_SEGMENTS,r.HEIGHT_SEGMENTS);return t.applyMatrix((new THREE.Matrix4).makeTranslation(this.center.x,this.center.y,this.center.z)),t},r.prototype.buildMaterial=function(){return new THREE.MeshLambertMaterial(r.MATERIAL_DEFAULTS)},r.prototype.buildThicknessVector=function(){var t=new THREE.Vector3(0,1,0);return new THREE.ArrowHelper(t,this.origin,this.thickness,16776960)},r.prototype.calculateAperture=function(){var t,e,r,o;t=this.geometry.vertices,e=t[0],r=e.distanceTo(this.center);for(var a=1;a<t.length;a++)o=t[a].distanceTo(this.center),r>o&&(e=t[a],r=o);return e},r.WIDTH_SEGMENTS=32,r.HEIGHT_SEGMENTS=32,r.MATERIAL_DEFAULTS={color:16777215,transparent:!0,opacity:.8},r.APERTURE_MARKER_COLOR=0,r.APERTURE_MARKER_SIZE_FACTOR=.05,r}(THREE.Mesh);t.Chamber=e}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(t){function e(r,o){this.foram=r,this.positionsBuffer=this.buildPositionsBuffer(),this.color=o&&o.color||e.DEFAULT_COLOR,this.width=o&&o.width||e.DEFAULT_WIDTH;var a=this.buildGeometry(),i=this.buildMaterial();t.call(this,a,i),this.rebuild()}return __extends(e,t),e.prototype.buildPath=function(t){var e,r,o;e=this.positionsBuffer.array,r=0;for(var a=0;a<t.length;a++)o=t[a],e[r++]=o.x,e[r++]=o.y,e[r++]=o.z;this.geometry.setDrawRange(0,t.length),this.positionsBuffer.needsUpdate=!0},e.prototype.fetchChambersAttribute=function(t){var e,r,o=[];e=this.foram.getActiveChambers();for(var a=0;a<e.length;a++)r=e[a],o.push(r[t]);return o},e.prototype.buildPositionsBuffer=function(){return new THREE.BufferAttribute(new Float32Array(3*e.MAX_POINTS),3)},e.prototype.buildGeometry=function(){var t=new THREE.BufferGeometry;return t.addAttribute("position",this.positionsBuffer),t},e.prototype.buildMaterial=function(){return new THREE.LineBasicMaterial({color:this.color,linewidth:this.width})},e.MAX_POINTS=100,e.DEFAULT_COLOR=16711680,e.DEFAULT_WIDTH=3,e}(THREE.Line);t.ChamberPath=e}(e=t.ChamberPaths||(t.ChamberPaths={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.rebuild=function(){var t=this.fetchChambersAttribute("center");this.buildPath(t)},e}(t.ChamberPath);t.CentroidsPath=e}(e=t.ChamberPaths||(t.ChamberPaths={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.rebuild=function(){var t=this.fetchChambersAttribute("aperture");this.buildPath(t)},e}(t.ChamberPath);t.AperturesPath=e}(e=t.ChamberPaths||(t.ChamberPaths={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e=function(){function t(t){this.foram=t}return t}();t.Calculator=e}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(){function t(t,e,r){this.va=t,this.vb=e,this.vc=r,this.centroid=this.calculateCentroid()}return t.prototype.calculateCentroid=function(){return this.va.clone().add(this.vb).add(this.vc).divideScalar(3)},t}();t.Face=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(e){var r=function(){function e(t){this.foram=t}return e.prototype.sumFaces=function(e){var r,o,a,i,n,s,c,h,u,l,p,m;r=this.foram.getActiveChambers(),m=0;for(var f=0;f<r.length;f++){o=r[f],i=o.geometry.faces,h=o.geometry.vertices;for(var d=0;d<i.length;d++){n=i[d],u=h[n.a],l=h[n.b],p=h[n.c],s=new t.Helpers.Face(u,l,p),c=!0;for(var v=0;v<r.length;v++)if(a=r[v],a!=o&&s.centroid.distanceTo(a.center)<a.radius){c=!1;break}c&&(m+=e(s))}}return m},e}();e.FacesProcessor=r}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(e){var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.calculate=function(){for(var t=0,e=0,r=this.foram.getActiveChambers();e<r.length;e++){var o=r[e];t+=o.getSurfaceArea()}return t},e}(t.Calculator);e.SurfaceAreaCalculator=r}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(e){var r=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.calculate=function(){var t=new e.FacesProcessor(this.foram);return t.sumFaces(this.calculateFaceTetrahedronVolume)},r.prototype.calculateFaceTetrahedronVolume=function(t){var e,r,o,a,i,n;return e=t.vc.x*t.vb.y*t.va.z,r=t.vb.x*t.vc.y*t.va.z,o=t.vc.x*t.va.y*t.vb.z,a=t.va.x*t.vc.y*t.vb.z,i=t.vb.x*t.va.y*t.vc.z,n=t.va.x*t.vb.y*t.vc.z,(-e+r+o-a-i+n)/6},r}(t.Calculator);e.VolumeCalculator=r}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(e){var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.calculate=function(){var t=this.calculateCentroidsPathLength(),e=this.calculateDistanceBetweenHeadAndTail();return t/e},e.prototype.calculateDistanceBetweenHeadAndTail=function(){var t,e,r;return t=this.foram.chambers,e=t[0],r=t[t.length-1],e.center.distanceTo(r.center)},e.prototype.calculateCentroidsPathLength=function(){var t,e,r,o;t=this.foram.getActiveChambers(),e=t[0],t.shift(),o=0;for(var a=0;a<t.length;a++)r=t[a],o+=e.center.distanceTo(r.center),e=r;return o},e}(t.Calculator);e.ShapeFactorCalculator=r}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e=function(e){function r(o,a){e.call(this),this.prevChambers=[],this.genotype=o,this.material=r.MATERIAL_DEFAULTS,this.colorSequencer=new t.Helpers.ColorSequencer,this.isColored=!1;var i=this.buildInitialChamber();this.chambers=[i],this.currentChamber=i,this.prevChambers[0]=i;for(var n=1;a>n;n++)this.evolve();this.thicknessVectorsVisible=!1}return __extends(r,e),r.prototype.evolve=function(){var t=this.currentChamber.child;if(t)this.currentChamber=t,this.currentChamber.visible=!0;else{var e=this.calculateNextChamber();this.chambers.push(e),this.currentChamber=e,this.add(e)}this.updateChamberPaths(),this.updateThicknessVectors()},r.prototype.regress=function(){var t=this.currentChamber.ancestor;t&&(this.currentChamber.visible=!1,this.currentChamber=t),this.updateChamberPaths()},r.prototype.toggleCentroidsPath=function(){this.centroidsPath||(this.centroidsPath=new t.ChamberPaths.CentroidsPath(this,{color:16711680}),this.centroidsPath.visible=!1,this.add(this.centroidsPath)),this.centroidsPath.visible=!this.centroidsPath.visible},r.prototype.toggleAperturesPath=function(){this.aperturesPath||(this.aperturesPath=new t.ChamberPaths.AperturesPath(this,{color:65280}),this.aperturesPath.visible=!1,this.add(this.aperturesPath)),this.aperturesPath.visible=!this.aperturesPath.visible},r.prototype.showThicknessVectors=function(){for(var t=0,e=this.chambers;t<e.length;t++){var r=e[t];r.showThicknessVector()}},r.prototype.hideThicknessVectors=function(){for(var t=0,e=this.chambers;t<e.length;t++){var r=e[t];r.hideThicknessVector()}},r.prototype.toggleThicknessVectors=function(){this.thicknessVectorsVisible=!this.thicknessVectorsVisible,this.updateThicknessVectors()},r.prototype.calculateSurfaceArea=function(){var e=new t.Calculators.SurfaceAreaCalculator(this);return e.calculate()},r.prototype.calculateVolume=function(){var e=new t.Calculators.VolumeCalculator(this);return e.calculate()},r.prototype.calculateShapeFactor=function(){var e=new t.Calculators.ShapeFactorCalculator(this);return e.calculate()},r.prototype.applyOpacity=function(t){this.material.opacity=t,this.updateChambersMaterial()},r.prototype.colour=function(e){this.colorSequencer=new t.Helpers.ColorSequencer(e),this.updateChambersColors(),this.isColored=!0},r.prototype.decolour=function(){this.resetChambersColors(),this.isColored=!1},r.prototype.getActiveChambers=function(){for(var t,e=[],r=0,o=this.chambers;r<o.length;r++)t=o[r],t.visible&&e.push(t);return e},r.prototype.calculateNextChamber=function(){var t,e,r,o,a;return t=this.calculateNewCenter(),e=this.calculateNewRadius(),r=this.calculateNewThickness(),o=this.buildChamber(t,e,r),a=this.calculateNewAperture(o),o.setAperture(a),o.setAncestor(this.currentChamber),this.prevChambers[2]=this.prevChambers[1],this.prevChambers[1]=this.prevChambers[0],this.prevChambers[0]=o,o},r.prototype.calculateNewCenter=function(){var t,e,r,o,a;switch(t=new THREE.Vector3,1==this.chambers.length?t.subVectors(this.prevChambers[0].aperture,this.prevChambers[0].center):t.subVectors(this.prevChambers[0].aperture,this.prevChambers[1].aperture),e=new THREE.Vector3,this.chambers.length){case 1:e.set(0,1,0);break;case 2:e.subVectors(this.prevChambers[1].center,this.prevChambers[1].aperture);break;default:e.subVectors(this.prevChambers[2].aperture,this.prevChambers[1].aperture)}r=new THREE.Vector3,r.crossVectors(t,e),r.normalize(),o=new THREE.Vector3,o.copy(t),o.applyAxisAngle(r,this.genotype.phi),t.normalize(),o.applyAxisAngle(t,this.genotype.beta);var i=this.calculateGrowthVectorLength();return o.setLength(i),a=new THREE.Vector3,a.copy(this.prevChambers[0].aperture),a.add(o),a},r.prototype.calculateGrowthVectorLength=function(){return this.currentChamber.radius*this.genotype.translationFactor},r.prototype.calculateNewRadius=function(){return this.currentChamber.radius*this.genotype.growthFactor},r.prototype.calculateNewThickness=function(){return this.currentChamber.thickness*this.genotype.wallThicknessFactor},r.prototype.calculateNewAperture=function(t){var e,r,o,a,i,n,s,c;for(e=t.geometry.vertices,r=this.prevChambers[0].aperture,o=e[0],a=o.distanceTo(r),c=1;c<e.length;c++)if(i=e[c].distanceTo(r),a>i){s=!1;for(var h=0,u=this.chambers;h<u.length;h++)if(n=u[h],n.radius>=e[c].distanceTo(n.center)){s=!0;break}s||(o=e[c],a=i)}return o},r.prototype.buildInitialChamber=function(){var t=this.buildChamber(new THREE.Vector3(0,0,0),r.INITIAL_RADIUS,r.INITIAL_THICKNESS);return t.markAperture(),this.add(t),t},r.prototype.buildChamber=function(e,r,o){var a=new t.Chamber(e,r,o);return a.applyMaterial(this.material),this.isColored&&a.setColor(this.colorSequencer.next()),a},r.prototype.updateChamberPaths=function(){this.centroidsPath&&this.centroidsPath.rebuild(),this.aperturesPath&&this.aperturesPath.rebuild()},r.prototype.updateThicknessVectors=function(){this.thicknessVectorsVisible?this.showThicknessVectors():this.hideThicknessVectors()},r.prototype.updateChambersMaterial=function(){for(var t=0,e=this.chambers;t<e.length;t++){var r=e[t];r.applyMaterial(this.material)}},r.prototype.updateChambersColors=function(){this.colorSequencer.reset();for(var t=0,e=this.chambers;t<e.length;t++){var r=e[t];r.setColor(this.colorSequencer.next())}},r.prototype.resetChambersColors=function(){for(var t=0,e=this.chambers;t<e.length;t++){var r=e[t];r.resetColor()}},r.INITIAL_RADIUS=5,r.INITIAL_THICKNESS=1,r.MATERIAL_DEFAULTS={opacity:.8},r}(THREE.Group);t.Foram=e}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e=function(t){function e(e){t.call(this),this.simulation=e,this.setup()}return __extends(e,t),e.prototype.setup=function(){var t=this,e=this.addFolder("Genotype"),r=this.addFolder("Structure analyzer"),o=this.addFolder("Material"),a={phi:.5,beta:.5,translationFactor:.5,growthFactor:1.1,wallThicknessFactor:1.1},i={numChambers:20,simulate:function(){return t.simulation.simulate(a,i.numChambers)},evolve:function(){return t.simulation.evolve()},regress:function(){return t.simulation.regress()},centroidsPath:function(){return t.simulation.toggleCentroidsPath()},aperturesPath:function(){return t.simulation.toggleAperturesPath()},thicknessVectors:function(){return t.simulation.toggleThicknessVectors()},fitTarget:function(){return t.simulation.fitTarget()}},n={opacity:.8,colour:function(){return t.simulation.colour()},decolour:function(){return t.simulation.decolour()}};e.add(a,"phi").step(.01),e.add(a,"beta").step(.01),e.add(a,"translationFactor").step(.01),e.add(a,"growthFactor").step(.01),e.add(a,"wallThicknessFactor").step(.01),r.add(i,"numChambers"),r.add(i,"simulate"),r.add(i,"evolve"),r.add(i,"regress"),r.add(i,"centroidsPath"),r.add(i,"aperturesPath"),r.add(i,"thicknessVectors"),r.add(i,"fitTarget"),o.add(n,"opacity").onFinishChange(function(){return t.simulation.applyOpacity(n.opacity)}),o.add(n,"colour"),o.add(n,"decolour")},e}(dat.GUI);t.SimulationGUI=e}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(){function t(t,e){this.camera=t,this.controls=e}return t.prototype.fitTarget=function(t){var e=this.calculateBoundingSphere(t),r=this.camera.position,o=e.center;this.controls.target.copy(o);var a=this.calculateDistanceToTarget(e),i=new THREE.Vector3;i.subVectors(r,o),i.setLength(a);var n=o.clone();n.add(i),this.camera.position.copy(n),this.camera.updateProjectionMatrix()},t.prototype.calculateBoundingSphere=function(t){for(var e=new THREE.Group,r=0,o=t.children;r<o.length;r++){var a=o[r];a.visible&&e.children.push(a)}var i=(new THREE.Box3).setFromObject(e);return i.getBoundingSphere()},t.prototype.calculateDistanceToTarget=function(t){return t.radius/Math.tan(this.camera.fov/2*Math.PI/180)},t}();t.TargetControls=e}(e=t.Controls||(t.Controls={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){function e(t,e,r){for(var o in r)e&&void 0!=e[o]?t[o]=e[o]:t[o]=r[o]}t.extend=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e=function(){function e(r,o){this.config={},t.Helpers.extend(this.config,o,e.DEFAULT_PARAMS),this.canvas=r,this.setupScene(),this.setupControls(),this.setupTargetControls(),this.setupMouseEvents(),this.setupAutoResize(),this.config.dev&&this.setupGUI(),this.animate()}return e.prototype.simulate=function(e,r){this.reset(),this.foram=new t.Foram(e,r),this.fitTarget(),this.scene.add(this.foram)},e.prototype.evolve=function(){this.foram&&this.foram.evolve()},e.prototype.regress=function(){this.foram&&this.foram.regress()},e.prototype.toggleCentroidsPath=function(){this.foram&&this.foram.toggleCentroidsPath()},e.prototype.toggleAperturesPath=function(){this.foram&&this.foram.toggleAperturesPath()},e.prototype.calculateSurfaceArea=function(){return this.foram?this.foram.calculateSurfaceArea():void 0},e.prototype.calculateVolume=function(){return this.foram?this.foram.calculateVolume():void 0},e.prototype.calculateShapeFactor=function(){return this.foram?this.foram.calculateShapeFactor():void 0},e.prototype.toggleThicknessVectors=function(){this.foram&&this.foram.toggleThicknessVectors()},e.prototype.applyOpacity=function(t){this.foram&&this.foram.applyOpacity(t)},e.prototype.colour=function(t){this.foram&&this.foram.colour(t)},e.prototype.decolour=function(){this.foram&&this.foram.decolour()},e.prototype.exportToOBJ=function(){return this.foram?(new THREE.OBJExporter).parse(this.foram):void 0},e.prototype.exportToCSV=function(){return this.foram?(new t.Export.CSVExporter).parse(this.foram):void 0},e.prototype.takeScreenshot=function(t){var t=t||"image/jpeg";return this.render(),this.renderer.domElement.toDataURL(t)},e.prototype.onChamberClick=function(t){this._onChamberClick=t},e.prototype.onChamberHover=function(t){this._onChamberHover=t},e.prototype.fitTarget=function(){this.foram&&this.targetControls.fitTarget(this.foram)},e.prototype.reset=function(){this.foram&&this.scene.remove(this.foram),this.foram=null},e.prototype.setupScene=function(){this.scene=new THREE.Scene;var t=this.canvas.clientWidth,e=this.canvas.clientHeight;this.camera=new THREE.PerspectiveCamera(45,t/e,.1,1e4),this.camera.position.set(0,0,70),this.scene.add(this.camera),this.lighting=new THREE.DirectionalLight(16777215,.9),this.camera.add(this.lighting),this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setClearColor(0,1),this.renderer.setSize(t,e),this.canvas.appendChild(this.renderer.domElement)},e.prototype.setupControls=function(){this.controls=new THREE.TrackballControls(this.camera,this.renderer.domElement),this.controls.rotateSpeed=5,this.controls.zoomSpeed=1.2,this.controls.panSpeed=.8,this.controls.noZoom=!1,this.controls.noPan=!1,this.controls.staticMoving=!0,this.controls.dynamicDampingFactor=.3,this.controls.keys=[65,83,68]},e.prototype.setupTargetControls=function(){this.targetControls=new t.Controls.TargetControls(this.camera,this.controls)},e.prototype.setupMouseEvents=function(){var t=this;this.renderer.domElement.addEventListener("click",function(e){return t.onMouseClick(e)}),this.renderer.domElement.addEventListener("mousemove",function(e){return t.onMouseMove(e)})},e.prototype.setupAutoResize=function(){var t=this;window.addEventListener("resize",function(){return t.resize()})},e.prototype.setupGUI=function(){this.gui=new t.SimulationGUI(this)},e.prototype.onMouseClick=function(t){if(t.preventDefault(),this._onChamberClick){var e=this.getPointedChamber(t);e&&this._onChamberClick(t,e.serialize())}},e.prototype.onMouseMove=function(t){if(t.preventDefault(),this._onChamberHover){var e=this.getPointedChamber(t);e&&this._onChamberHover(t,e.serialize())}},e.prototype.getPointedChamber=function(t){if(this.foram){var e=new THREE.Raycaster,r=new THREE.Vector2;r.x=t.clientX/this.renderer.domElement.clientWidth*2-1,r.y=2*-(t.clientY/this.renderer.domElement.clientHeight)+1,e.setFromCamera(r,this.camera);var o=e.intersectObjects(this.foram.chambers);return o.length>0?o[0].object:void 0}},e.prototype.resize=function(){var t=this.canvas.clientWidth,e=this.canvas.clientHeight;this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e)},e.prototype.animate=function(){var t=this;requestAnimationFrame(function(){return t.animate()}),this.controls.update(),this.render()},e.prototype.render=function(){this.renderer.render(this.scene,this.camera)},e.DEFAULT_PARAMS={dev:!1},e}();t.Simulation=e}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.parse=function(t){var e=[];for(var r in t.genotype)e.push(t.genotype[r]);return e.push(t.calculateSurfaceArea(),t.calculateVolume(),t.calculateShapeFactor()),e.join(";")},t}();t.CSVExporter=e}(e=t.Export||(t.Export={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(){function t(e){this.colors=e||t.COLORS,this.currentColorIndex=0}return t.prototype.next=function(){var t=this.colors[this.currentColorIndex];return this.currentColorIndex+=1,this.currentColorIndex%=this.colors.length,t},t.prototype.reset=function(){this.currentColorIndex=0},t.COLORS=[16711680,65280,255],t}();t.ColorSequencer=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(){function e(t){this.mesh=t,this.faces=this.getFaces(),this.vertices=this.getVertices(),this.currentFaceIndex=0}return e.prototype.hasNext=function(){return this.currentFaceIndex<this.faces.length-1},e.prototype.next=function(){var e=this.faces[this.currentFaceIndex];return this.currentFaceIndex+=1,this.currentFaceIndex%=this.faces.length,new t.Face(this.vertices[e.a],this.vertices[e.b],this.vertices[e.c])},e.prototype.reset=function(){this.currentFaceIndex=0},e.prototype.getFaces=function(){return this.mesh.geometry.faces},e.prototype.getVertices=function(){return this.mesh.geometry.vertices},e}();t.FacesIterator=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(e){function r(o,a,i){this.start=o,this.end=a,t.extend(this,i,r.DEFAULT_PARAMS);var n=this.buildGeometry(),s=this.buildMaterial();e.call(this,n,s)}return __extends(r,e),r.prototype.buildGeometry=function(){var t,e,r,o;return t=new THREE.Geometry,e=new THREE.Vector3,e.subVectors(this.start,this.end),e.normalize(),r=new THREE.Vector3,r.addVectors(this.start,e.multiplyScalar(this.length)),o=new THREE.Vector3,o.addVectors(this.end,e.negate()),t.vertices.push(r,o),t},r.prototype.buildMaterial=function(){return new THREE.LineBasicMaterial({color:this.color})},r.DEFAULT_PARAMS={color:16711680,length:2.5},r}(THREE.Line);t.Line=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(e){function r(o,a,i,n){this.position=(new THREE.Vector3).copy(o),this.spanningVector1=(new THREE.Vector3).copy(a),this.spanningVector2=(new THREE.Vector3).copy(i),t.extend(this,n,r.DEFAULT_PARAMS),this.normalizeSpanningVectors();var s=this.buildGeometry(),c=this.buildMaterial();e.call(this,s,c)}return __extends(r,e),r.prototype.normalizeSpanningVectors=function(){this.spanningVector1.normalize().multiplyScalar(this.size),this.spanningVector2.normalize().multiplyScalar(this.size)},r.prototype.buildGeometry=function(){var t,e,r,o,a;return t=new THREE.Geometry,e=(new THREE.Vector3).copy(this.position),r=(new THREE.Vector3).copy(this.position),o=(new THREE.Vector3).copy(this.position),a=(new THREE.Vector3).copy(this.position),e.add(this.spanningVector1),r.add(this.spanningVector2),o.sub(this.spanningVector1),a.sub(this.spanningVector2),t.vertices.push(e,r,o,a),t.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(0,2,3)),t},r.prototype.buildMaterial=function(){return new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:this.color,transparent:!0,opacity:this.opacity})},r.DEFAULT_PARAMS={color:16711680,size:10,opacity:.3},r}(THREE.Mesh);t.Plane=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e=function(e){function r(o,a){t.extend(this,a,r.DEFAULT_PARAMS);var i=this.buildGeometry(),n=this.buildMaterial();e.call(this,i,n),this.position.copy(o)}return __extends(r,e),r.prototype.buildGeometry=function(){return new THREE.SphereGeometry(this.size,r.WIDTH_SEGMENTS,r.HEIGHT_SEGMENTS)},r.prototype.buildMaterial=function(){return new THREE.MeshLambertMaterial({color:this.color})},r.WIDTH_SEGMENTS=32,r.HEIGHT_SEGMENTS=32,r.DEFAULT_PARAMS={color:16711680,size:.3},r}(THREE.Mesh);t.Point=e}(e=t.Helpers||(t.Helpers={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t){this.chamber=t}return t}();t.Calculator=e}(e=t.Chamber||(t.Chamber={}))}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.calculate=function(){return this.chamber.getSurfaceArea()*this.chamber.thickness},e}(t.Calculator);t.MaterialVolumeCalculator=e}(e=t.Chamber||(t.Chamber={}))}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));var Foram3D;!function(t){var e;!function(e){var r;!function(e){var r=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.calculate=function(){var e,r,o,a,i,n=0;for(e=this.chamber.getIntersectingChambers(),r=new t.Helpers.FacesIterator(this.chamber);r.hasNext();){o=r.next(),a=!0;for(var s=0;s<e.length;s++)if(i=e[s],o.centroid.distanceTo(i.center)<i.radius){a=!1;break}a&&(n+=this.calculateFaceSurfaceArea(o))}return n},r.prototype.calculateFaceSurfaceArea=function(t){var e,r,o;return e=t.vb.clone().sub(t.va),r=t.vc.clone().sub(t.va),o=new THREE.Vector3,o.crossVectors(e,r),o.length()/2},r}(e.Calculator);e.SurfaceAreaCalculator=r}(r=e.Chamber||(e.Chamber={}))}(e=t.Calculators||(t.Calculators={}))}(Foram3D||(Foram3D={}));